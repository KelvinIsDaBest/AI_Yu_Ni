<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Secret Code</title>
  <style>
    body {
      background: linear-gradient(135deg, #a259c6 0%, #6d3a8c 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 16px;
      box-sizing: border-box;
    }
    .yam-container {
      background: #e6d0f7;
      border-radius: 32px;
      box-shadow: 0 8px 32px rgba(108, 52, 131, 0.2);
      padding: 48px 32px 32px 32px;
      display: flex;
      flex-direction: column;
      align-items: center;
      border: 4px solid #a259c6;
      position: relative;
      width: 100%;
      max-width: 400px;
      min-width: 280px;
    }
    .yam-icon {
      width: 80px;
      height: 80px;
      margin-bottom: 16px;
      background: radial-gradient(circle at 60% 40%, #b57edc 60%, #a259c6 100%);
      border-radius: 50% 60% 55% 65% / 60% 55% 65% 50%;
      box-shadow: 0 4px 16px #a259c6aa;
      position: relative;
    }
    .yam-icon::after {
      content: '';
      position: absolute;
      left: 20px;
      top: 30px;
      width: 18px;
      height: 18px;
      background: #fff3;
      border-radius: 50%;
      filter: blur(2px);
    }
    h2 {
      color: #6d3a8c;
      margin-bottom: 24px;
      font-size: 2rem;
      letter-spacing: 2px;
      text-shadow: 0 2px 8px #a259c655;
      text-align: center;
    }
    .code-inputs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .code-inputs input {
      width: 40px;
      height: 56px;
      font-size: 2rem;
      text-align: center;
      border: 2px solid #a259c6;
      border-radius: 12px;
      background: #fff;
      color: #6d3a8c;
      outline: none;
      transition: border 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px #a259c622;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }
    .code-inputs input:focus {
      border: 2px solid #6d3a8c;
      box-shadow: 0 0 0 2px #a259c655;
    }
    .code-inputs input:disabled {
      opacity: 0.6;
      background: #f5f5f5;
    }
    .error-message {
      color: #c0392b;
      font-size: 1rem;
      min-height: 24px;
      margin-top: 8px;
      text-align: center;
      letter-spacing: 1px;
    }
    
    /* Mobile responsive styles */
    @media (max-width: 768px) {
      body {
        padding: 12px;
      }
      .yam-container {
        padding: 32px 24px 24px 24px;
        border-radius: 24px;
        border-width: 3px;
      }
      .yam-icon {
        width: 60px;
        height: 60px;
      }
      .yam-icon::after {
        left: 15px;
        top: 22px;
        width: 14px;
        height: 14px;
      }
      h2 {
        font-size: 1.5rem;
        letter-spacing: 1px;
        margin-bottom: 20px;
      }
      .code-inputs {
        gap: 6px;
      }
      .code-inputs input {
        width: 36px;
        height: 48px;
        font-size: 1.5rem;
        border-radius: 8px;
      }
    }
    
    @media (max-width: 480px) {
      .yam-container {
        padding: 24px 16px 16px 16px;
        border-radius: 20px;
        border-width: 2px;
      }
      .yam-icon {
        width: 50px;
        height: 50px;
        margin-bottom: 12px;
      }
      .yam-icon::after {
        left: 12px;
        top: 18px;
        width: 12px;
        height: 12px;
      }
      h2 {
        font-size: 1.25rem;
        margin-bottom: 16px;
      }
      .code-inputs {
        gap: 4px;
      }
      .code-inputs input {
        width: 32px;
        height: 44px;
        font-size: 1.25rem;
        border-radius: 6px;
      }
      .error-message {
        font-size: 0.9rem;
      }
    }
    
    /* Touch-friendly improvements */
    @media (hover: none) and (pointer: coarse) {
      .code-inputs input {
        min-height: 44px; /* iOS minimum touch target */
        font-size: 1.5rem;
      }
      .code-inputs input:focus {
        transform: scale(1.05);
      }
    }
    
    /* Landscape orientation adjustments */
    @media (max-height: 500px) and (orientation: landscape) {
      body {
        padding: 8px;
      }
      .yam-container {
        padding: 20px 16px 16px 16px;
      }
      .yam-icon {
        width: 40px;
        height: 40px;
        margin-bottom: 8px;
      }
      h2 {
        font-size: 1.1rem;
        margin-bottom: 12px;
      }
      .code-inputs input {
        width: 28px;
        height: 36px;
        font-size: 1.1rem;
      }
    }
  </style>
</head>
<body>
  <div class="yam-container">
    <div class="yam-icon"></div>
    <h2>Enter Secret Code</h2>
    <form id="mainForm" autocomplete="off" onsubmit="return false;">
      <div style="margin-bottom:18px;width:100%;max-width:320px;">
        <label for="nameInput" style="color:#6d3a8c;font-size:1.1rem;font-weight:bold;">Name:</label><br>
        <input type="text" id="nameInput" name="entry.1348445555" style="width:100%;font-size:1.1rem;padding:8px 10px;border-radius:8px;border:2px solid #a259c6;margin-top:6px;box-sizing:border-box;" required />
      </div>
      <div class="code-inputs">
        <input type="text" maxlength="1" inputmode="numeric" pattern="[0-9]*" />
        <input type="text" maxlength="1" inputmode="numeric" pattern="[0-9]*" />
        <input type="text" maxlength="1" inputmode="numeric" pattern="[0-9]*" />
        <input type="text" maxlength="1" inputmode="numeric" pattern="[0-9]*" />
        <input type="text" maxlength="1" inputmode="numeric" pattern="[0-9]*" />
        <input type="text" maxlength="1" inputmode="numeric" pattern="[0-9]*" />
        <input type="text" maxlength="1" inputmode="numeric" pattern="[0-9]*" />
      </div>
      <div class="error-message" id="errorMsg"></div>
      <div class="error-message" id="usedMsg" style="color:#2e7d32;"></div>
      <button type="submit" id="submitBtn" style="display:none"></button>
    </form>
    <form id="hiddenGoogleForm" action="https://docs.google.com/forms/u/0/d/e/1FAIpQLScioAqZtj5qdElTokNih707dlucRfdOZZvHLDtBCJFdlCIOuQ/formResponse" method="POST" target="_blank" style="display:none">
      <input name="entry.1348445555" id="hiddenNameField" />
    </form>
  </div>
  <script>
    // Predefined 7-digit secret code
    const SECRET_CODE = "4866945"; // Change this to your desired code
    const inputs = document.querySelectorAll('.code-inputs input');
    const errorMsg = document.getElementById('errorMsg');
    const nameInput = document.getElementById('nameInput');
    const mainForm = document.getElementById('mainForm');
    const hiddenGoogleForm = document.getElementById('hiddenGoogleForm');
    const hiddenNameField = document.getElementById('hiddenNameField');
    const usedMsg = document.getElementById('usedMsg');

    // Abuse prevention: check if code already used
    if (localStorage.getItem('secretCodeUsed') === '1') {
      disableInputs();
      usedMsg.textContent = 'You have already used the secret code.';
    }

    function disableInputs() {
      inputs.forEach(i => { i.disabled = true; i.value = ''; });
      nameInput.disabled = true;
    }

    // Restore name if page reloads
    if (localStorage.getItem('userName')) {
      nameInput.value = localStorage.getItem('userName');
    }
    nameInput.addEventListener('input', function() {
      localStorage.setItem('userName', nameInput.value);
    });

    // Auto-focus next input with mobile-friendly improvements
    inputs.forEach((input, idx) => {
      input.addEventListener('input', (e) => {
        if (input.disabled) return;
        const value = e.target.value.replace(/[^0-9]/g, '');
        e.target.value = value;
        if (value && idx < inputs.length - 1) {
          // Small delay for better mobile experience
          setTimeout(() => {
            inputs[idx + 1].focus();
          }, 50);
        }
        checkCode();
      });
      
      input.addEventListener('keydown', (e) => {
        if (input.disabled) return;
        if (e.key === 'Backspace' && !input.value && idx > 0) {
          inputs[idx - 1].focus();
        }
      });
      
      // Handle paste events for mobile
      input.addEventListener('paste', (e) => {
        e.preventDefault();
        const pastedData = (e.clipboardData || window.clipboardData).getData('text');
        const numbers = pastedData.replace(/[^0-9]/g, '').slice(0, 7);
        
        if (numbers.length > 0) {
          // Fill inputs with pasted numbers
          numbers.split('').forEach((num, i) => {
            if (inputs[i]) {
              inputs[i].value = num;
            }
          });
          
          // Focus the next empty input or the last one
          const nextEmptyIndex = Math.min(numbers.length, inputs.length - 1);
          if (inputs[nextEmptyIndex]) {
            inputs[nextEmptyIndex].focus();
          }
          
          checkCode();
        }
      });
    });

    function checkCode() {
      if (localStorage.getItem('secretCodeUsed') === '1') return;
      const code = Array.from(inputs).map(i => i.value).join('');
      if (code.length === 7) {
        if (!nameInput.value.trim()) {
          errorMsg.textContent = 'Please enter your name.';
          nameInput.focus();
          return;
        }
        if (code === SECRET_CODE) {
          errorMsg.textContent = '';
          // Set name in hidden form and submit
          hiddenNameField.value = nameInput.value;
          localStorage.setItem('secretCodeUsed', '1');
          setTimeout(() => {
            hiddenGoogleForm.submit();
            disableInputs();
            usedMsg.textContent = 'You have already used the secret code.';
          }, 400);
        } else {
          errorMsg.textContent = 'Incorrect code. Try again!';
          // Clear code fields only, keep name
          inputs.forEach(i => i.value = '');
          inputs[0].focus();
        }
      } else {
        errorMsg.textContent = '';
      }
    }
    
    // Prevent form submit on Enter
    mainForm.addEventListener('submit', function(e) { e.preventDefault(); });
    
    // Auto-focus first input on page load for better mobile experience
    window.addEventListener('load', function() {
      if (!localStorage.getItem('secretCodeUsed')) {
        setTimeout(() => {
          inputs[0].focus();
        }, 100);
      }
    });
  </script>
</body>
</html>
