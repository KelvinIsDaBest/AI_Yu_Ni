<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Secret Code</title>
  <style>
    body {
      background: linear-gradient(135deg, #a259c6 0%, #6d3a8c 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
    }
    .yam-container {
      background: #e6d0f7;
      border-radius: 32px;
      box-shadow: 0 8px 32px rgba(108, 52, 131, 0.2);
      padding: 48px 32px 32px 32px;
      display: flex;
      flex-direction: column;
      align-items: center;
      border: 4px solid #a259c6;
      position: relative;
    }
    .yam-icon {
      width: 80px;
      height: 80px;
      margin-bottom: 16px;
      background: radial-gradient(circle at 60% 40%, #b57edc 60%, #a259c6 100%);
      border-radius: 50% 60% 55% 65% / 60% 55% 65% 50%;
      box-shadow: 0 4px 16px #a259c6aa;
      position: relative;
    }
    .yam-icon::after {
      content: '';
      position: absolute;
      left: 20px;
      top: 30px;
      width: 18px;
      height: 18px;
      background: #fff3;
      border-radius: 50%;
      filter: blur(2px);
    }
    h2 {
      color: #6d3a8c;
      margin-bottom: 24px;
      font-size: 2rem;
      letter-spacing: 2px;
      text-shadow: 0 2px 8px #a259c655;
    }
    .code-inputs {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }
    .code-inputs input {
      width: 40px;
      height: 56px;
      font-size: 2rem;
      text-align: center;
      border: 2px solid #a259c6;
      border-radius: 12px;
      background: #fff;
      color: #6d3a8c;
      outline: none;
      transition: border 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px #a259c622;
    }
    .code-inputs input:focus {
      border: 2px solid #6d3a8c;
      box-shadow: 0 0 0 2px #a259c655;
    }
    .error-message {
      color: #c0392b;
      font-size: 1rem;
      min-height: 24px;
      margin-top: 8px;
      text-align: center;
      letter-spacing: 1px;
    }
  </style>
</head>
<body>
  <div class="yam-container">
    <div class="yam-icon"></div>
    <h2>Enter Secret Code</h2>
    <form id="mainForm" autocomplete="off" onsubmit="return false;">
      <div style="margin-bottom:18px;width:100%;max-width:320px;">
        <label for="nameInput" style="color:#6d3a8c;font-size:1.1rem;font-weight:bold;">Name:</label><br>
        <input type="text" id="nameInput" name="entry.1348445555" style="width:100%;font-size:1.1rem;padding:8px 10px;border-radius:8px;border:2px solid #a259c6;margin-top:6px;box-sizing:border-box;" required />
      </div>
      <div class="code-inputs">
        <input type="text" maxlength="1" inputmode="numeric" pattern="[0-9]*" />
        <input type="text" maxlength="1" inputmode="numeric" pattern="[0-9]*" />
        <input type="text" maxlength="1" inputmode="numeric" pattern="[0-9]*" />
        <input type="text" maxlength="1" inputmode="numeric" pattern="[0-9]*" />
        <input type="text" maxlength="1" inputmode="numeric" pattern="[0-9]*" />
        <input type="text" maxlength="1" inputmode="numeric" pattern="[0-9]*" />
        <input type="text" maxlength="1" inputmode="numeric" pattern="[0-9]*" />
      </div>
      <div class="error-message" id="errorMsg"></div>
      <div class="error-message" id="usedMsg" style="color:#2e7d32;"></div>
      <button type="submit" id="submitBtn" style="display:none"></button>
    </form>
    <form id="hiddenGoogleForm" action="https://docs.google.com/forms/u/0/d/e/1FAIpQLScioAqZtj5qdElTokNih707dlucRfdOZZvHLDtBCJFdlCIOuQ/formResponse" method="POST" target="_blank" style="display:none">
      <input name="entry.1348445555" id="hiddenNameField" />
    </form>
  </div>
  <script>
    // Predefined 7-digit secret code
    const SECRET_CODE = "4866945"; // Change this to your desired code
    const inputs = document.querySelectorAll('.code-inputs input');
    const errorMsg = document.getElementById('errorMsg');
    const nameInput = document.getElementById('nameInput');
    const mainForm = document.getElementById('mainForm');
    const hiddenGoogleForm = document.getElementById('hiddenGoogleForm');
    const hiddenNameField = document.getElementById('hiddenNameField');
    const usedMsg = document.getElementById('usedMsg');

    // Abuse prevention: check if code already used
    if (localStorage.getItem('secretCodeUsed') === '1') {
      disableInputs();
      usedMsg.textContent = 'You have already used the secret code.';
    }

    function disableInputs() {
      inputs.forEach(i => { i.disabled = true; i.value = ''; });
      nameInput.disabled = true;
    }

    // Restore name if page reloads
    if (localStorage.getItem('userName')) {
      nameInput.value = localStorage.getItem('userName');
    }
    nameInput.addEventListener('input', function() {
      localStorage.setItem('userName', nameInput.value);
    });

    // Auto-focus next input
    inputs.forEach((input, idx) => {
      input.addEventListener('input', (e) => {
        if (input.disabled) return;
        const value = e.target.value.replace(/[^0-9]/g, '');
        e.target.value = value;
        if (value && idx < inputs.length - 1) {
          inputs[idx + 1].focus();
        }
        checkCode();
      });
      input.addEventListener('keydown', (e) => {
        if (input.disabled) return;
        if (e.key === 'Backspace' && !input.value && idx > 0) {
          inputs[idx - 1].focus();
        }
      });
    });

    function checkCode() {
      if (localStorage.getItem('secretCodeUsed') === '1') return;
      const code = Array.from(inputs).map(i => i.value).join('');
      if (code.length === 7) {
        if (!nameInput.value.trim()) {
          errorMsg.textContent = 'Please enter your name.';
          nameInput.focus();
          return;
        }
        if (code === SECRET_CODE) {
          errorMsg.textContent = '';
          // Set name in hidden form and submit
          hiddenNameField.value = nameInput.value;
          localStorage.setItem('secretCodeUsed', '1');
          setTimeout(() => {
            hiddenGoogleForm.submit();
            disableInputs();
            usedMsg.textContent = 'You have already used the secret code.';
          }, 400);
        } else {
          errorMsg.textContent = 'Incorrect code. Try again!';
          // Clear code fields only, keep name
          inputs.forEach(i => i.value = '');
          inputs[0].focus();
        }
      } else {
        errorMsg.textContent = '';
      }
    }
    // Prevent form submit on Enter
    mainForm.addEventListener('submit', function(e) { e.preventDefault(); });
  </script>
</body>
</html>
